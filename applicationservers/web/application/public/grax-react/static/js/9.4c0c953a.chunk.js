(this.webpackJsonpgraxreact=this.webpackJsonpgraxreact||[]).push([[9,15],{253:function(e,t,a){"use strict";a.r(t);var n=a(36),i=a(42),l=a(43),s=a(44),r=a(0),o=a.n(r),c=a(16),u=a(139),d=a(13),p=a.n(d),h=a(282),m=a(5),g=a(11),f=a(119),b=a(276),v=a(75),y=a(274),S=a(121),_=a(283),O=a(286),E=a(280),F=a(21),x=function(e){return e.split(/\\n/).join("<br/>").split(/\\\\/).join("\\")},k=function(e){var t=e.children,a=Object(g.a)(e,["children"]);return o.a.createElement(f.a,{title:t},t&&o.a.createElement("span",{style:{display:"inline-block",cursor:"pointer",whiteSpace:"normal",wordWrap:"break-word",wordBreak:"break-all"},onClick:function(){a.onClickHandler&&a.onClickHandler(t)},dangerouslySetInnerHTML:{__html:x(t.slice(0,255))+(t.length>255?"&hellip;":"")}}))};k.displayName=f.a.displayName;var C=function(e){Object(l.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={sortColumn:"CreatedDate",sortDirection:"desc",items:[],extraInfo:{},page:0,isLoaded:!1,isLoading:!1,isStackModalOpen:!1,stackModalHtml:null},i}return Object(i.a)(a,[{key:"shouldComponentUpdate",value:function(e,t){return this.props.renderKey!==e.renderKey||this.state.items!==t.items||this.state.isLoaded!==t.isLoaded||this.state.isLoading!==t.isLoading||this.state.sortColumn!==t.sortColumn||this.state.sortDirection!==t.sortDirection||this.state.isStackModalOpen!==t.isStackModalOpen}},{key:"getDataHandler",value:function(e,t,a){this.setState({isLoading:!0,page:e,sortColumn:t,sortDirection:a}),E.a.ajax({type:"GET",url:E.c+"/grax-app/grax-data-lake"+Object(E.b)({action:"load",dataIndex:this.props.dataIndex,_select:p.a.union(this.props.columns,this.props.hiddenColumns).join(",")||"Id",_q:this.props.filterQuery,_limit:20,_from:20*e,_sort:t+" "+a,_sortType:this.getSortFieldType(t)}),success:function(e){var t=e.results;this.props.filterFunction&&(t=this.props.filterFunction(t)),t=p.a.map(t,(function(e,t){return p.a.forEach(e,(function(t,a){if("string"==typeof t&&F.d.test(t)){var n=F.m.utc(t);n.isValid()&&(e[a]=n.tz(F.e).format(-1!==n._i.indexOf(":")?F.a:F.b))}})),Object(m.a)({},e,{},{id:t.toString()})})),this.setState({page:0,data:t,extraInfo:e.extraInfo||{total:0,size:20,totalRetrieved:0},items:t,isLoaded:!0,isLoading:!1})}.bind(this),error:function(e,t,a){console.error(e,t,a),this.setState({isLoaded:!0,isLoading:!1,items:[],error:a.toString()})}.bind(this)})}},{key:"componentDidMount",value:function(){this.getDataHandler(0,this.state.sortColumn,this.state.sortDirection)}},{key:"handleSort",value:function(e){e.property&&this.getDataHandler(this.state.page,e.property,e.sortDirection)}},{key:"getSortFieldType",value:function(e){return this.props._graxFieldsSelection?(this.props._graxFieldsSelection.find((function(t){return t.id===e}))||{}).type:null}},{key:"render",value:function(){var e=this;return this.state.isLoaded?o.a.createElement("div",null,this.state.isStackModalOpen?o.a.createElement(b.a,{assistiveText:{dialogLabel:"Stack"},isOpen:this.state.isStackModalOpen,onRequestClose:function(){e.setState({isStackModalOpen:!1,stackModalHtml:null})},align:"top",size:"large"},o.a.createElement("section",{className:"slds-p-around_medium",style:{overflow:"auto"}},o.a.createElement("span",{style:{display:"inline-block",whiteSpace:"normal",wordWrap:"break-word",wordBreak:"break-all"},dangerouslySetInnerHTML:{__html:this.state.stackModalHtml}}))):null,o.a.createElement("div",{style:{position:"relative"}},this.state.isLoading&&o.a.createElement(v.a,{size:"large",variant:"brand"}),o.a.createElement(y.a,{assistiveText:{actionsHeader:"actions",columnSort:"sort this column",columnSortedAscending:"asc",columnSortedDescending:"desc",selectAllRows:"all rows",selectRow:"select this row"},fixedLayout:!0,items:this.state.items,id:"GRAXLoggingDataTable",onSort:this.handleSort.bind(this)},this.props.columns.map((function(t){return o.a.createElement(S.a,{key:"col"+t,id:t,isSorted:e.state.sortColumn===t,label:t.endsWith(".keyword")?t.match(/(.+)\.keyword/)[1]:t,property:t,sortable:!0,sortDirection:e.state.sortDirection,isSortable:null==e.props.sortableColumns||-1!==e.props.sortableColumns.indexOf(t)},"stack"===t||"error"===t||"description"===t?o.a.createElement(k,{onClickHandler:function(t){t&&e.setState({isStackModalOpen:!0,stackModalHtml:x(t.slice(1,-1)).split(/\s/g).join("&nbsp;")})}}):null)})))),o.a.createElement("div",{className:"-x-small-buttons--horizontal slds-p-top_small"},o.a.createElement(_.a,{totalItems:this.state.items.length>0?this.state.extraInfo.total:0,pageSize:20,onChangePage:function(t,a){a||e.getDataHandler(t-1,e.state.sortColumn,e.state.sortDirection)}})),o.a.createElement("div",{className:"-x-small-buttons--horizontal slds-p-top_medium"},o.a.createElement(O.a,{params:{source:"elastic",dataIndex:this.props.dataIndex,_select:p.a.union(this.props.columns,this.props.hiddenColumns).join(","),_q:this.props.filterQuery,_sort:this.state.sortColumn+" "+this.state.sortDirection,_sortType:this.getSortFieldType(this.state.sortColumn),columns:this.props.columns}}))):o.a.createElement("div",{style:{position:"relative",height:"2rem"}},o.a.createElement(v.a,{size:"medium",variant:"brand"}))}}]),a}(o.a.Component),N=a(285),j=a(287),D=a(7),V=a(278),L=[{key:"batch-id",property:"batchId",label:"Batch ID"},{key:"num-records",property:"total",label:"# of Records"},{key:"obj-type",property:"objectType",label:"Object Type"},{key:"queued",property:"statusQueued",label:"Queued"},{key:"done",property:"statusDone",label:"Done"},{key:"completed",property:"completed",label:"% Completed"},{key:"start-time",property:"strStartDate",label:"Start Time"},{key:"end-time",property:"strEndDate",label:"End Time"}],I=function(e){var t=e.children,a=Object(g.a)(e,["children"]),n=a.onSelectBatchId,i=a.item;return o.a.createElement(f.a,{title:t},o.a.createElement(c.a,{variant:"base",title:i.batchId,label:"".concat(i.batchId.substring(0,15),"..."),onClick:function(e){e.preventDefault(),n&&n(i.batchId)}}))};I.displayName=f.a.displayName;var M=function(e){Object(l.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onDataLoaded=function(e){if(Array.isArray(e)){var t=1;e.forEach((function(e){e.completed="".concat(Math.round(100*e.statusDone/e.total),"%");var a=e.startDate?Object(F.m)(e.startDate):void 0;e.strStartDate=a?a.format("L LT"):"",e.unixStateDate=a?a.unix():Number.MAX_SAFE_INTEGER,a=e.endDate?Object(F.m)(e.endDate):void 0,e.strEndDate=a?a.format("L LT"):"",e.unixEndDate=a?a.unix():Number.MAX_SAFE_INTEGER,e.id="".concat(t),t+=1})),i.allItems=e,i.sortData()}else i.allItems=[]},i.onDataLoadError=function(e,t,a){i.setState({error:a.toString()})},i.loadData=function(){i.setState({items:[],pageNum:0}),E.a.ajax({type:"GET",url:"".concat(E.c,"/grax-app/grax-data-lake/asyncQueue/status"),data:{days:7,type:"Restore"},success:i.onDataLoaded,error:i.onDataLoadError})},i.updatePage=function(e){i.setState({pageNum:e,items:i.allItems.slice(25*e,25*(e+1))})},i.sortData=function(e,t){var a=i.state,n=a.sortColumn,l=a.sortColumnDirection,s=e||n,r=t||l[s];i.allItems.sort((function(e,t){var a,n,i=s;"strStartDate"===s?i="unixStateDate":"strEndDate"===s&&(i="unixEndDate"),"completed"===i?(a=Math.round(100*e.statusDone/e.total),n=Math.round(100*t.statusDone/t.stotal)):(a=e[i],n=t[i]);var l=0;return a>n&&(l=1),a<n&&(l=-1),"desc"===r&&(l*=-1),l})),s===n&&r===l[s]||i.setState({sortColumn:s,sortColumnDirection:Object(D.a)({},s,r)}),i.updatePage(0)},i.handleSort=function(e){var t=e.property,a=e.sortDirection;i.sortData(t,a)},i.handleChangePage=function(e){i.updatePage(e-1)},i.state={items:[],sortColumn:"strStartDate",sortColumnDirection:Object(D.a)({},"strStartDate","desc")},i.allItems=[],i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.loadData()}},{key:"render",value:function(){var e=this.state,t=e.items,a=e.error,n=e.pageNum,i=e.sortColumn,l=e.sortColumnDirection,s=this.props.onSelectBatchId;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"-x-small-buttons--horizontal slds-p-bottom_large"},o.a.createElement(c.a,{label:"Retrieve",variant:"brand",onClick:this.loadData})),a&&o.a.createElement("div",{style:{clear:"both"}},o.a.createElement(V.a,{theme:"dark"},o.a.createElement("p",null,a))),t.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement(y.a,{assistiveText:{actionsHeader:"actions",columnSort:"sort this column",columnSortedAscending:"asc",columnSortedDescending:"desc"},style:{marginBottom:"5px"},items:t,fixedLayout:!0,onSort:this.handleSort},L.map((function(e){return o.a.createElement(S.a,{key:e.key,property:e.property,label:e.label,isSorted:i===e.property,sortable:!0,sortDirection:l[e.property]},"batchId"===e.property&&o.a.createElement(I,{onSelectBatchId:s}))}))),o.a.createElement("div",{className:"-x-small-buttons--horizontal slds-p-top_small"},o.a.createElement(_.a,{totalItems:this.allItems.length,pageSize:25,currentPage:n+1,onChangePage:this.handleChangePage}))))}}]),a}(o.a.Component);a.d(t,"default",(function(){return w}));var R=["text","date","number"],w=function(e){Object(l.a)(a,e);var t=Object(s.a)(a);function a(e){var i;Object(n.a)(this,a),(i=t.call(this,e)).onSelectBatchId=function(e){i.setState({filterBatchId:e}),i.retrieveLogs()},i.onRemoveFilterBatchId=function(){i.setState({filterBatchId:void 0}),i.retrieveLogs()},i.retrieveLogs=function(){var e=i.state.retrievedCounter;i.setState({retrievedCounter:e+1})},i._isMounted=!1;var l=i.props.columns,s=void 0===l?["Id"]:l;return i.state={retrievedCounter:0,_graxFields:null,_graxFieldsSelection:null,_graxFieldsSelectionList:s,_filterFunction:function(e){return e},_getFilterQuery:function(){},_filterValuesFields:[],_graxSortableFields:null},i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this.state._graxFieldsSelectionList;this._isMounted=!0,E.a.ajax({type:"GET",url:"".concat(E.c,"/grax-app/grax-data-lake/getDataTypeFields/graxgrax_loggingindex").concat(Object(E.b)({action:"load"})),data:{},success:function(t){this._isMounted&&this.setState({_graxFields:p.a.map(e,(function(e,a){return{id:e,label:e,type:t[e]}}))})}.bind(this),error:function(e,t,a){console.error(e,t,a)}})}},{key:"getFilterQuery",value:function(e){var t=this.props.subtype,a='doc.attributes.type.keyword: "grax_logging';t&&(a+="+".concat(t)),a+='"';var n=e();n&&(a+=" AND (".concat(n,")"));var i=this.state.filterBatchId;return i&&(a+=' AND (doc.executionUniqueKey.keyword: "'.concat(i,'")')),a}},{key:"hasFieldSelected",value:function(){var e=this.state,t=e._graxFields,a=e._graxFieldsSelectionList;return null!=t&&null!=a&&a.length>0}},{key:"render",value:function(){var e=this,t=this.state,a=t.filterBatchId,n=t._graxFieldsSelection,i=t._graxFieldsSelectionList,l=t._graxFields,s=t._getFilterQuery,r=t._filterFunction,d=t._filterValuesFields,m=t._graxSortableFields,g=t.retrievedCounter,f=this.props.subtype;return o.a.createElement("div",null,o.a.createElement("div",{style:{display:"none"}},o.a.createElement(j.default,{dataIndex:"graxgrax_loggingindex",onLoad:function(t,a,n,i){console.log("onLoad",a,i,n),e.setState({_graxFieldsSelection:a,_graxSortableFields:p.a.reduce(n,(function(e,t,a){return-1!==R.indexOf(t.type)&&e.push(t.id),e}),[])})},cookieSubfix:f||"logs"})),"restore"===f&&o.a.createElement(h.a,{isCollapsible:!0,isOpen:!0,title:"Restore Status"},o.a.createElement(M,{onSelectBatchId:this.onSelectBatchId})),o.a.createElement(h.a,{isCollapsible:!0,isOpen:!0,title:"Filter Logs"},null!=i&&o.a.createElement(N.a,{filterableFieldOptions:l,onFilterValueChangeHandler:function(t,a,l){e.setState({retrievedCounter:g,_filterFunction:t,_getFilterQuery:l,_graxFieldsSelection:n,_graxFieldsSelectionList:i,_filterValuesFields:a})}}),o.a.createElement("div",{className:"slds-m-bottom_large"})),o.a.createElement(h.a,{isCollapsible:!0,isOpen:!0,title:"GRAX Logs"},o.a.createElement("div",{className:"-x-small-buttons--horizontal slds-p-bottom_large"},o.a.createElement(c.a,{label:"Retrieve",variant:"brand",onClick:this.retrieveLogs}),a&&o.a.createElement("span",{className:"slds-m-left_small"},o.a.createElement(u.a,{labels:{label:"".concat(a),title:"filtered by batch ID",removeTitle:"Remove"},onRemove:this.onRemoveFilterBatchId}))),o.a.createElement(C,{key:"GRAXLoggingDataTable_".concat(g),renderKey:"GRAXLoggingDataTable_".concat(g),columns:i,_graxFieldsSelection:n,sortableColumns:m,hiddenColumns:d,dataIndex:"graxgrax_loggingindex",filterFunction:r,filterQuery:this.getFilterQuery(s)})))}}]),a}(o.a.Component)},280:function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"f",(function(){return s})),a.d(t,"d",(function(){return o})),a.d(t,"e",(function(){return c})),a.d(t,"b",(function(){return u}));var n=a(281),i=a.n(n);a.d(t,"a",(function(){return i.a}));var l="",s=window.__grax__.token,r=window.__grax__._csrf,o=window.__grax__.orgid,c=(window.__grax__.userid,window.__grax__.pageParams||{});function u(e){return null!==e&&void 0!==e||(e={}),null!==e.action&&void 0!==e.action&&""!==e.action||(e.action="load"),"?"+i.a.param(e)}i.a.ajaxSetup({beforeSend:function(e,t){var a;e.setRequestHeader("sfdcorgid",o),null!=c.authorization?e.setRequestHeader("Authorization","Basic "+c.authorization):e.setRequestHeader("Authorization","Bearer "+s),a=t.type,/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)||this.crossDomain||e.setRequestHeader("X-CSRFToken",r),e.withCredentials=!0,!0!==t.skipFail&&e.fail((function(e,t,a){console.error(e),404!==e.status&&"Not Found"!==a&&window.showError(e.statusText+": "+e.responseText)}))}})},282:function(e,t,a){"use strict";var n=a(36),i=a(42),l=a(86),s=a(43),r=a(44),o=a(0),c=a.n(o),u=a(10),d=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var i;Object(n.a)(this,a),i=t.call(this,e);var s=e.isOpen,r=e.isCollapsible;return i.state={isOpen:!0===s||void 0===r},i.handleToggle=i.handleToggle.bind(Object(l.a)(i)),i}return Object(i.a)(a,[{key:"handleToggle",value:function(e){var t=this.props.onToggle;this.setState((function(e){return{isOpen:!e.isOpen}})),t&&t(isOpen),e.preventDefault()}},{key:"render",value:function(){var e=this.props,t=e.id,a=e.key,n=e.isCollapsible,i=e.title,l=e.helpText,s=e.className,r=e.children,o=this.state.isOpen,d=c.a.createElement("span",{className:"slds-truncate".concat(n?"":" slds-p-horizontal_small"),title:i},i,l);return c.a.createElement("div",{id:t||a,className:["slds-section",o&&"slds-is-open",s].join(" ")},c.a.createElement("h3",{className:"slds-section__title slds-theme_shade"},n?c.a.createElement("button",{type:"button",className:"slds-button slds-section__title-action",onClick:this.handleToggle},c.a.createElement(u.a,{assistiveText:{label:i},category:"utility",name:"switch",size:"x-small",className:"slds-section__title-action-icon slds-button__icon slds-button__icon_left"}),d):d),o&&c.a.createElement("div",{className:"slds-section__content"},r))}}]),a}(c.a.Component);t.a=d},283:function(e,t,a){"use strict";var n=a(36),i=a(42),l=a(43),s=a(44),r=a(53),o=a(0),c=a.n(o),u=a(267),d=a(16),p=a(51),h=function(e){Object(l.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={pager:{}},i}return Object(i.a)(a,[{key:"componentWillMount",value:function(){var e=this.props,t=e.totalItems,a=e.currentPage;t&&this.setPage(a,!0)}},{key:"setPage",value:function(e,t){var a=this.props,n=a.totalItems,i=a.pageSize,l=this.state.pager;e<1||e>l.totalPages||(l=function(e,t,a){t=t||1,a=a||10;var n=!1;e>1e4&&(e=1e4,n=!0);var i,l,s=Math.ceil(e/a);s<=10?(i=1,l=s):t<=6?(i=1,l=10):n&&t+3>=s?(i=s-8,l=s):t+4>=s?(i=s-9,l=s):(i=t-5,l=t+4);var o=(t-1)*a,c=Math.min(o+a-1,e-1),u=Object(r.a)(Array(l+1-i).keys()).map((function(e){return i+e}));return{totalItems:e,currentPage:t,pageSize:a,totalPages:s,startPage:i,endPage:l,startIndex:o,endIndex:c,pages:u,isNarrow:n}}(n,e,i),this.setState({pager:l}),this.props.onChangePage(e,t))}},{key:"render",value:function(){var e=this,t=this.state.pager;return!t.pages||t.pages.length<=1?null:c.a.createElement(u.a,null,c.a.createElement(d.a,{iconCategory:"utility",iconName:"left",iconPosition:"left",label:"First",variant:"neutral",onClick:function(){return e.setPage(1)},disabled:1===t.currentPage}),c.a.createElement(d.a,{iconCategory:"utility",iconName:"chevronleft",iconPosition:"left",variant:"neutral",onClick:function(){return e.setPage(t.currentPage-1)},disabled:1===t.currentPage}),t.pages.map((function(a,n){return c.a.createElement(d.a,{key:"SLDSPaginator".concat(Date.now()).concat(n),label:a,variant:t.currentPage===a?"brand":"neutral",onClick:function(){return e.setPage(a)}})})),t.isNarrow&&t.currentPage>=t.totalPages-3&&c.a.createElement(p.a,{align:"top right",content:"The list is too long, try adding more filters to optimize the results."},c.a.createElement(d.a,{label:"\xb7\xb7\xb7",variant:"neutral"})),c.a.createElement(d.a,{iconCategory:"utility",iconName:"chevronright",iconPosition:"right",variant:"neutral",onClick:function(){return e.setPage(t.currentPage+1)},disabled:t.currentPage===t.totalPages}),c.a.createElement(d.a,{iconCategory:"utility",iconName:"right",iconPosition:"right",label:"Last",variant:"neutral",onClick:function(){return e.setPage(t.totalPages)},disabled:t.currentPage===t.totalPages}))}}]),a}(c.a.Component);h.defaultProps={currentPage:1,pageSize:10},t.a=h},284:function(e,t,a){"use strict";var n=a(3),i=a(0),l=a.n(i),s=a(301),r=a(21);t.a=function(e){var t=Object(i.useState)(!0),a=Object(n.a)(t,2),o=a[0],c=a[1];return l.a.createElement("div",{className:"slds-is-relative"},l.a.createElement(s.a,Object.assign({formatter:r.g,parser:r.h},e,{onChange:function(t,a){c(""===a.formattedDate||Object(r.m)(a.date).isValid()),null!=e.onChange&&e.onChange(t,a)}})),!1===o?l.a.createElement("div",{className:"slds-text-color_error"},"The date is invalid. Please select/write a valid date."):null)}},285:function(e,t,a){"use strict";var n=a(53),i=a(36),l=a(42),s=a(43),r=a(44),o=a(0),c=a.n(o),u=a(13),d=a.n(u),p=a(22),h=a.n(p),m=a(270),g=a(269),f=a(75),b=a(72),v=a(255),y=a(16),S=a(280),_=a(21),O=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={options:[],inputValue:"",selection:[],isLoaded:!1,error:null},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){S.a.ajax({type:"GET",url:S.c+"/grax-app/grax-data-lake/salesforce/sobjects/"+this.props.SObjectName+"/fields/"+this.props.fieldName+Object(S.b)({action:"load"}),data:{_select:"name,type,picklistValues"},success:function(e){this.setState({options:d.a.map(e.picklistValues||[],(function(e,t){return{id:e.value,label:e.label}})),isLoaded:!0}),this.props.onLoad&&this.props.onLoad(!0)}.bind(this),error:function(e,t,a){console.error(e,t,a),this.setState({isLoaded:!0,error:a.toString()}),this.props.onLoad&&this.props.onLoad(!1,a)}.bind(this)})}},{key:"render",value:function(){var e=this;return this.state.error?c.a.createElement("div",null,"Error: ",this.state.error):this.state.isLoaded?null==this.state.options||0===this.state.options.length?(this.props.onElseComponent&&this.props.onRender(!1),this.props.elseComponent):(this.props.onLoad&&this.props.onRender(!0),c.a.createElement(c.a.Fragment,null,c.a.createElement(g.a,{classNameMenu:"scrollable-GRAXSFieldCombobox",events:{onChange:function(t,a){var n=a.value;e.setState({inputValue:n}),e.props.onChange&&e.props.onChange(t,n)},onRequestRemoveSelectedOption:function(t,a){e.setState({inputValue:"",selection:a.selection}),e.props.onRequestRemoveSelectedOption&&e.props.onRequestRemoveSelectedOption(t,a.selection)},onSelect:function(t,a){e.setState({inputValue:"",selection:a.selection}),e.props.onSelect&&e.props.onSelect(t,a.selection)},onRequestClose:function(t,a){e.props.onSelect&&e.state.inputValue&&e.props.onSelect(t,[{id:e.state.inputValue,label:e.state.inputValue}])}},labels:{placeholder:"Select Option"},options:Object(_.f)({inputValue:this.state.inputValue,limit:1e3,options:this.state.options,selection:this.state.selection}),selection:this.state.selection,value:this.state.inputValue,variant:this.props.variant||"inline-listbox",multiple:this.props.multiple||!1,required:!0}))):c.a.createElement("div",{style:{position:"relative",height:"2rem"}},c.a.createElement(f.a,{size:"small",variant:"base"}))}}]),a}(c.a.Component),E=a(284);a.d(t,"a",(function(){return C}));var F=function(e){return e.replace(/[\*\+\-=~><\"\?^\${}\(\)\:\!\/[\]\\\s]/g,"\\$&").replace(/\|\|/g,"\\||").replace(/\&\&/g,"\\&&").replace(/AND/g,"\\A\\N\\D").replace(/OR/g,"\\O\\R").replace(/NOT/g,"\\N\\O\\T")},x={text:[{id:"eq",label:"==",isNegated:!1},{id:"eq",label:"!=",isNegated:!0},{id:"contains",label:"contains",isNegated:!1},{id:"contains",label:"not contains",isNegated:!0},{id:"in",label:"in",isNegated:!1},{id:"in",label:"not in",isNegated:!0},{id:"exists",label:"exists",isNegated:!1,type:"boolean"}],date:[{id:"eq",label:"==",isNegated:!1},{id:"eq",label:"!=",isNegated:!0},{id:"gt",label:">",isNegated:!1},{id:"lt",label:"<",isNegated:!1},{id:"gte",label:">=",isNegated:!1},{id:"lte",label:"<=",isNegated:!1},{id:"exists",label:"exists",isNegated:!1,type:"boolean"}],number:[{id:"eq",label:"==",isNegated:!1},{id:"eq",label:"!=",isNegated:!0},{id:"gt",label:">",isNegated:!1},{id:"lt",label:"<",isNegated:!1},{id:"gte",label:">=",isNegated:!1},{id:"lte",label:"<=",isNegated:!1},{id:"exists",label:"exists",isNegated:!1,type:"boolean"}],long:[{id:"eq",label:"==",isNegated:!1},{id:"eq",label:"!=",isNegated:!0},{id:"gt",label:">",isNegated:!1},{id:"lt",label:"<",isNegated:!1},{id:"gte",label:">=",isNegated:!1},{id:"lte",label:"<=",isNegated:!1},{id:"exists",label:"exists",isNegated:!1,type:"boolean"}],boolean:[{id:"eq",label:"==",isNegated:!1},{id:"exists",label:"exists",isNegated:!1}]},k=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e))._isMounted=!1,n.state={inputValue:"",selection:[],isOpened:!1},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.props.selection&&(console.log(this.props.selection),this.setState({selection:this.props.selection}))}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"filterOptionsHandler",value:function(){var e=this.props.options||[];return this.props.filterOptionsHandler&&this.state.isOpened&&(e=this.props.filterOptionsHandler(e)),Object(m.a)({inputValue:this.state.inputValue,limit:1e3,options:e,selection:this.state.selection})}},{key:"render",value:function(){var e=this;return c.a.createElement(c.a.Fragment,null,c.a.createElement(g.a,{classNameMenu:"scrollable-GRAXFilterableCombobox",events:{onChange:function(t,a){var n=a.value;e.setState({inputValue:n}),e.props.onChange&&e.props.onChange(t,n)},onRequestRemoveSelectedOption:function(t,a){e._isMounted&&e.setState({inputValue:"",selection:a.selection}),e.props.onRequestRemoveSelectedOption&&e.props.onRequestRemoveSelectedOption(t,a.selection)},onSelect:function(t,a){e._isMounted&&e.setState({inputValue:"",selection:a.selection}),e.props.onSelect&&e.props.onSelect(t,a.selection)},onOpen:function(t,a){e._isMounted&&e.setState({isOpened:!0})},onClose:function(t,a){e._isMounted&&e.setState({isOpened:!1})}},labels:{placeholder:this.props.placeholder},options:this.filterOptionsHandler(),selection:this.state.selection,value:this.state.inputValue,variant:this.props.variant||"inline-listbox",required:!0,multiple:!1}))}}]),a}(c.a.Component),C=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={_filterValues:null,_error:null,_filterValuesFields:[]},n}return Object(l.a)(a,[{key:"isLoaded",value:function(){return this.state._error||null!=this.props.filterableFieldOptions}},{key:"getFilterValueStruct",value:function(){return{id:null,value:null,operator:"eq",isNegated:!1,isActive:!0,selectedField:null}}},{key:"getFilterValuesList",value:function(e){var t=this;return d.a.map(e,(function(e,a){var n=t.getFilterValueStruct();return n.id=a,n.value=e.value,n.operator=e.operator,n.isNegated=e.isNegated,n.isActive=e.isActive,n.selectedField=d.a.filter(t.props.filterableFieldOptions,(function(e,t){return e&&e.id===a}))[0]||null,n}))}},{key:"componentDidMount",value:function(){var e=this.props.filterValues||{},t=Object.keys(e);this.setState({_filterValues:e,_filterValuesFields:t,_filterValuesList:this.getFilterValuesList(e)}),this.props.onFilterValueChangeHandler(this.getFilterFunction.bind(this),t,this.getFilterQuery.bind(this),this.state._filterValues)}},{key:"onFilterValueChangeHandler",value:function(e,t){var a=this.state._filterValues;if(t&&t.length>0){var n=t[0]||null;e.id=n.id,e.selectedField=n,a[e.id]={value:e.value,isActive:e.isActive,operator:e.operator,isNegated:e.isNegated,selectedField:n}}else delete a[e.id],e.id=null,e.selectedField=null;var i=Object.keys(a);this.setState({_filterValues:a,_filterValuesFields:i,_filterValuesList:this.state._filterValuesList}),this.props.onFilterValueChangeHandler&&this.props.onFilterValueChangeHandler(this.getFilterFunction.bind(this),i,this.getFilterQuery.bind(this),this.state._filterValues)}},{key:"addAnotherFieldHandler",value:function(){var e=this.state._filterValuesList;0!==e.length&&null==e[e.length-1].id||(e.push(this.getFilterValueStruct()),this.setState({_filterValuesList:e}))}},{key:"removeFieldHandler",value:function(e){var t=this.state._filterValues,a=this.state._filterValuesList;delete t[a[e].id],a.splice(e,1),this.setState({_filterValues:t,_filterValuesFields:Object.keys(t),_filterValuesList:a})}},{key:"getFilterFunction",value:function(e){var t=this;return d.a.filter(e,(function(e,a){var i=!0;return d.a.forEach(t.state._filterValues,(function(t,a){if(t.isActive){var l=t.operator,s=t.value;"in"!==l&&Array.isArray(s)?s=s.length>0?s[0]:null:"in"!==l||Array.isArray(s)||(s=s.split(" OR "));var r=t.isNegated,o=!1,c=e[a];"eq"!==l||""===s||Boolean(s)||(l="exists",r=!1),Array.isArray(s)&&"in"!==l&&(s=s.length>0?s[0]:null),"date"===t.selectedField.type&&((c=h()(c))&&(c=c.format("YYYY-MM-DD")),(s=h()(s))&&(s=s.format("YYYY-MM-DD"))),"boolean"!==t.selectedField.type||Boolean(s)||(s=!0,r=!0),o="exists"===l?Boolean(c)===Boolean(s):"contains"===l?String(c).toLowerCase().includes(s.toLowerCase()):"in"===l?s&&s.length>0&&d.a.includes.apply(d.a,[s].concat(Object(n.a)("string"===typeof c?[c]:c))):d.a[l](c,s),i&=r?!o:o}})),i}))||[]}},{key:"getFilterQuery",value:function(){var e={gt:">",gte:">=",lt:"<",lte:"<="},t=[];return d.a.forEach(this.state._filterValues,(function(a,n){var i=a.operator;if(a.isActive&&!i.startsWith("_")){var l=a.value;"in"!==i&&Array.isArray(l)?l=l.length>0?F(l[0]):null:"in"!==i||Array.isArray(l)||(l=d.a.map(l.split(" OR "),(function(e){return F(e)})));var s=a.isNegated;"eq"===i&&s&&!Boolean(l)&&(i="exists",l=s),"exists"===i&&(s=!Boolean(l));var r="(";if(s&&(r+="NOT "),r+="(","boolean"!==a.selectedField.type||Boolean(l)||(r+="NOT "),"in"===i){var o=[];d.a.each(l,(function(e,t){o.push('"'+e+'"')})),r+="doc."+n+":("+o.join(" OR ")+")"}else if("exists"===i)r+="_exists_:doc."+n;else if(r+="doc."+n+":","eq"===i)"boolean"===a.selectedField.type?r+="true":"number"===a.selectedField.type?r+=l?parseFloat(l):"":"date"===a.selectedField.type?r+=l?h()(l).format("YYYY-MM-DD"):"":r+='"'+l+'"';else if("contains"===i){var c=l?String(l):"";r+="(",r+='"'+F(l)+'"',r+=" OR ",r+=F(c.toLowerCase()),r+=" OR ",r+="*"+F(c.toLowerCase())+"*",r+=")"}else"date"===a.selectedField.type?r+=e[i]+(l?h()(l).format("YYYY-MM-DD"):""):r+=e[i]+(l?F(l):"");r+="))",t.push(r)}})),t.length>0?t.join(" AND "):null}},{key:"getSelectionValues",value:function(e){return e?d.a.reduce(e,(function(e,t){return e.push(t.id),e}),[]):null}},{key:"render",value:function(){var e=this;return this.state._error?c.a.createElement("div",null,"Error: ",this.state._error):this.isLoaded()?c.a.createElement(c.a.Fragment,null,c.a.createElement("table",{className:"slds-table slds-table_cell-buffer slds-table_bordered slds-no-row-hover"},c.a.createElement("thead",null,c.a.createElement("tr",{className:"slds-line-height_reset"},c.a.createElement("th",{className:"slds-text-title_caps",scope:"col"},c.a.createElement("div",{className:"slds-truncate",title:"Field"},"Field")),c.a.createElement("th",{className:"slds-text-title_caps",scope:"col"},c.a.createElement("div",{className:"slds-truncate",title:"Operator"},"Operator")),c.a.createElement("th",{className:"slds-text-title_caps",scope:"col"},c.a.createElement("div",{className:"slds-truncate",title:"Filter Value"},"Filter Value")),c.a.createElement("th",{className:"slds-text-title_caps",scope:"col"},c.a.createElement("div",{className:"slds-truncate",title:"Is Active?"},"Is Active?")),c.a.createElement("th",{className:"slds-text-title_caps",scope:"col"},c.a.createElement("div",{className:"slds-truncate"})))),c.a.createElement("tbody",null,d.a.map(this.state._filterValuesList,function(e,t){var a=this,n=e.id,i=e.selectedField||{};return c.a.createElement("tr",{className:"slds-hint-parent",key:"fieldName: "+(n||"")},c.a.createElement("td",{"data-label":"Field",style:{width:"30vw"}},n||c.a.createElement(k,{placeholder:"Select Field to filter",options:this.props.filterableFieldOptions||[],filterOptionsHandler:function(e){return d.a.filter(e,(function(e,t){return e&&-1===a.state._filterValuesFields.indexOf(e.id)}))||[]},selection:d.a.find(this.props.filterableFieldOptions,(function(e){return e&&e.id===n}))||[],onSelect:function(t,n){return a.onFilterValueChangeHandler(e,n)},onRequestRemoveSelectedOption:function(t,n){return a.onFilterValueChangeHandler(e,n)}})),c.a.createElement("td",{"data-label":"Operator",style:{width:"20vw"}},i&&("boolean"===i.type&&x[i.type].label||c.a.createElement(k,{placeholder:"Select Operator to Compare",options:x[i.type]||[],selection:[],variant:"readonly",onSelect:function(t,n){n[0].type=n[0].type||e.selectedField.type,e.operator=n[0].id,e.isNegated=n[0].isNegated,e.type!==n[0].type&&(e.value=null,"boolean"===n[0].type&&(e.value=!1),"text"===n[0].type&&(e.value=""),e.type=n[0].type),a.onFilterValueChangeHandler(e,[e.selectedField])}}))),c.a.createElement("td",{"data-label":"Filter Value",style:{width:"30vw"}},i&&(("boolean"===i.type||"exists"===e.operator)&&c.a.createElement(b.a,{defaultChecked:e.value,onChange:function(t){e.value=t.target.checked,a.onFilterValueChangeHandler(e,[e.selectedField])}})||("text"===i.type||"number"===i.type||"long"===i.type)&&c.a.createElement(O,{SObjectName:this.props.SObjectType,fieldName:i.id,onSelect:function(t,n){e.value=a.getSelectionValues(n),a.onFilterValueChangeHandler(e,[e.selectedField])},onRequestRemoveSelectedOption:function(t,n){e.value=a.getSelectionValues(n),a.onFilterValueChangeHandler(e,[e.selectedField])},elseComponent:c.a.createElement(v.a,{defaultValue:e.value,assistiveText:{label:i.label},id:i.id,onBlur:function(t){e.value=t.target.value,a.onFilterValueChangeHandler(e,[e.selectedField])}}),onRender:function(e){},multiple:"in"===e.operator,variant:"in"===e.operator?"base":"inline-listbox"})||"date"===i.type&&c.a.createElement(E.a,{value:e.value,onChange:function(t,n){e.value=n.date,a.onFilterValueChangeHandler(e,[e.selectedField])},className:"inline-table",menuPosition:"relative",hasStaticAlignment:!0}))),c.a.createElement("td",{"data-label":"Is Active?",style:{width:"10vw"}},c.a.createElement(b.a,{defaultChecked:e.isActive,onChange:function(t){e.isActive=t.target.checked,a.onFilterValueChangeHandler(e,[e.selectedField])}})),c.a.createElement("td",{"data-label":"Actions",style:{width:"10vw"}},c.a.createElement(y.a,{label:"Remove Filter",variant:"base",onClick:function(){a.removeFieldHandler(t)}})))}.bind(this)))),c.a.createElement("div",{className:"slds-p-top_medium"},c.a.createElement(y.a,{label:"Add Filter",variant:"brand",onClick:function(){e.addAnotherFieldHandler()},disabled:null==this.props.filterableFieldOptions||0===this.props.filterableFieldOptions.length||this.props.filterableFieldOptions.length===this.state._filterValuesFields.length}))):c.a.createElement("div",{style:{position:"relative",height:"5rem"}},c.a.createElement(f.a,{size:"small",variant:"base"}))}}]),a}(c.a.Component)},286:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(36),i=a(42),l=a(43),s=a(44),r=a(0),o=a.n(r),c=a(14),u=a.n(c),d=a(13),p=a.n(d),h=a(280),m=document.getElementById("portals"),g=function(e){Object(l.a)(a,e);var t=Object(s.a)(a);function a(e){return Object(n.a)(this,a),t.call(this,e)}return Object(i.a)(a,[{key:"render",value:function(){return u.a.createPortal(o.a.createElement("form",{id:this.props.formId,action:h.c+"/grax-app/grax-data-lake/export/"+this.props.params.source+"/csv"+Object(h.b)({action:"export",token:h.f,orgid:h.d}),target:"_blank",method:"POST",encType:"application/x-www-form-urlencoded",style:{margin:0,padding:0,border:0,display:"inline-block"}},p.a.map(this.props.params,(function(e,t){return o.a.createElement("input",{type:"hidden",key:String(Date.now())+t,name:t,value:e||""})}))),m)}}]),a}(o.a.Component),f=function(e){Object(l.a)(a,e);var t=Object(s.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={formId:"csvExport"+Date.now()},i}return Object(i.a)(a,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(g,{formId:this.state.formId,params:this.props.params}),o.a.createElement("button",{className:"slds-button slds-button_neutral",type:"submit",form:this.state.formId},"Export to CSV"))}}]),a}(o.a.Component)},287:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return v}));var n,i=a(36),l=a(42),s=a(86),r=a(43),o=a(44),c=a(0),u=a.n(c),d=a(13),p=a.n(d),h=a(75),m=a(269),g=a(280),f=a(21),b="Fields",v=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={options:[],inputValue:"",selection:[{id:"Id",label:"Id",type:"text"}],isLoaded:!1,error:null},n.getMappedFieldList=n.getMappedFieldList.bind(Object(s.a)(n)),n}return Object(l.a)(a,[{key:"getMappedFieldList",value:function(e){return p.a.map(e||this.state.selection,(function(e){return e.id}))}},{key:"onLoadHandler",value:function(e,t){var a=this.getMappedFieldList(t);this.props.onLoad&&this.props.onLoad(e,t,this.state.options,a)}},{key:"onChangeHandler",value:function(e,t){var a=this.getMappedFieldList(t);this.props.onChange&&this.props.onChange(e,t,this.state.options,a),Object(f.o)(n+b,JSON.stringify(a))}},{key:"componentDidMount",value:function(){var e=this;this._isMounted=!0,n=this.props.dataIndex,this.props.cookieSubfix&&(b+=this.props.cookieSubfix),g.a.ajax({type:"GET",url:g.c+"/grax-app/grax-data-lake/getDataTypeFields/"+n+Object(g.b)({action:"load"}),data:{},success:function(t){if(e._isMounted){var a=p.a.map(t,(function(e,t){return{id:t,label:t,type:e}}));e.setState({options:a,isLoaded:!0});var i=Object(f.i)(n+b);i.startsWith("[")||(i="[]");var l=JSON.parse(i);e.setState({selection:l.length>0?p.a.sortBy(p.a.reduce(a,(function(e,t){return-1!==l.indexOf(t.id)&&e.push(t),e}),[]),(function(e){return l.indexOf(e.id)})):e.state.selection})}e.onLoadHandler(null,e.state.selection)},error:function(t,a,n){console.error(t,a,n),e._isMounted&&e.setState({isLoaded:!0,error:n.toString()})}})}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this;return this.state.error?u.a.createElement("div",null,"Error: ",this.state.error):this.state.isLoaded?u.a.createElement(u.a.Fragment,null,u.a.createElement(m.a,{classNameMenu:"scrollable-GRAXFieldsCombobox",events:{onChange:function(t,a){var n=a.value;e.setState({inputValue:n})},onRequestRemoveSelectedOption:function(t,a){e.setState({inputValue:"",selection:a.selection}),e.onChangeHandler(t,a.selection)},onSelect:function(t,a){e.setState({inputValue:"",selection:a.selection}),e.onChangeHandler(t,a.selection)},onRequestClose:function(t,a){if(e.props.onSelect&&e.state.inputValue){var n=e.getMappedFieldList(a.selection);e.props.onSelect(t,[{id:e.state.inputValue,label:e.state.inputValue}],e.state.options,n)}}},labels:{placeholder:"Select Option"},options:Object(f.f)({inputValue:this.state.inputValue,limit:1e3,options:this.state.options,selection:this.state.selection}),selection:this.state.selection,value:this.state.inputValue,required:!0,multiple:!0})):u.a.createElement("div",{style:{position:"relative",height:"2rem"}},u.a.createElement(h.a,{size:"small",variant:"base"}))}}]),a}(u.a.Component)}}]);
//# sourceMappingURL=9.4c0c953a.chunk.js.map